trigger:
  branches:
    include:
      - main

pool:
  name: Default

steps:
- script: |
    echo "=== CONFIGURACIÃ“N EN MAC ==="
    echo "Usuario: $(whoami)"
    echo "Directorio: $(pwd)"
    python3 --version
    pip3 --version
  displayName: 'Verificar entorno Mac'

- script: |
    echo "=== INSTALANDO DEPENDENCIAS ==="
    python3 -m pip install --upgrade pip
    python3 -m pip install -r requirements.txt
    python3 -m pip install pytest pytest-cov coverage
  displayName: 'Instalar dependencias'

- script: |
    echo "=== EJECUTANDO PRUEBAS UNITARIAS ==="
    python3 -m unittest test_core_bancario -v
  displayName: 'Pruebas unitarias (unittest)'

- script: |
    echo "=== EJECUTANDO CON PYTEST ==="
    python3 -m pytest test_core_bancario.py -v
  displayName: 'Pruebas con pytest'

- script: |
    echo "=== CALCULANDO COBERTURA ==="
    python3 -m pytest --cov=core_bancario --cov-report=term
  displayName: 'Cobertura de cÃ³digo (terminal)'

- script: |
    echo "=== GENERANDO REPORTE HTML ==="
    python3 -m pytest --cov=core_bancario --cov-report=html
  displayName: 'Reporte HTML de cobertura'

- script: |
    echo "=== ğŸ“Š ESTADÃSTICAS FINALES ==="
    echo ""
    echo "LÃ­neas de cÃ³digo:"
    wc -l core_bancario.py
    echo ""
    echo "LÃ­neas de pruebas:"
    wc -l test_core_bancario.py
    echo ""
    echo "Total pruebas ejecutadas:"
    python3 -m pytest test_core_bancario.py --collect-only 2>/dev/null | grep "test_" | wc -l
  displayName: 'Generar estadÃ­sticas'